import{a as K,c as b,d as x}from"./chunk-DW66PHBU.js";import{e as S}from"./chunk-4TG7HONN.js";import"./chunk-6QOSJNPS.js";import{a as g}from"./chunk-MNS7ISQU.js";import{b as v}from"./chunk-GGM2I3UO.js";import{c as f,f as h}from"./chunk-J3XWRTOX.js";import{a as e}from"./chunk-TJ55WERY.js";import{b as u}from"./chunk-442635WZ.js";import{d,e as y}from"./chunk-A24ONYSU.js";import{d as c}from"./chunk-4C7GSA6N.js";import"./chunk-JG7V63GM.js";function N({entry:{key:t,value:n,versionstamp:a},deleteEntry:r}){return e("div",{class:"border rounded p-4 mb-4",children:[e("div",{class:"flex",children:[e("h2",{class:"font-bold my-2 flex-grow",children:"Key"}),e("button",{type:"button",class:"flex-none text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:ring-4 focus:outline-none focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-1.5",onClick:r,children:e(b,{size:4})})]}),e(K,{value:t,noLink:!0}),n?e(c,{children:[e(x,{value:n}),e("div",{class:"text-sm text-gray-600 dark:text-gray-400 p-1 italic",children:["Version: ",a]})]}):e("div",{class:"w-auto p-8 flex justify-center",children:e("div",{class:"italic text-gray-600 dark:text-gray-400",children:"no value"})})]},S(t))}function w({databaseId:t,name:n,href:a,entries:r,deleteHandler:i}){return e("div",{children:[e("h1",{class:"text-xl font-bold py-2",children:a?e("a",{href:a,children:n}):n}),r.value.map(s=>e(N,{entry:s,deleteEntry:()=>i(s.key)}))]},t)}var o=y([]),l=new Map,p=new Map,m=new Map;async function k(t,n){if((await fetch(new URL("/api/watch",import.meta.url),{method:"DELETE",body:JSON.stringify({databaseId:t,key:n}),headers:{"content-type":"application/json"}})).ok){let r=f(n),i=l.get(t).value.filter(({key:s})=>!h(r,f(s)));d(()=>{l.get(t).value=i,i.length||(l.delete(t),p.delete(t),m.delete(t),o.value=o.value.filter(s=>s!==t))}),v("Watch removed","success",!0)}else v("Could not delete watch.","error",!0)}if(u){let t=new URL("/api/watch/server",import.meta.url);t.protocol=t.protocol==="http:"?"ws:":"wss:",new WebSocket(t).addEventListener("message",({data:a})=>{let r=JSON.parse(a);d(()=>{o.value.includes(r.databaseId)?l.get(r.databaseId).value=r.entries:(r.name&&p.set(r.databaseId,r.name),r.href&&m.set(r.databaseId,r.href),l.set(r.databaseId,y(r.entries))),o.value=[r.databaseId,...o.value.filter(i=>i!==r.databaseId)]})})}function E(){return o.value.length?e(c,{children:[e(g,{}),o.value.map(t=>e(w,{databaseId:t,name:p.get(t)??t,href:m.get(t),entries:l.get(t),deleteHandler:n=>k(t,n)}))]}):e(c,{children:[e(g,{}),e("div",{class:"col-span-3 p-8 flex justify-center",children:e("div",{class:"italic text-gray-600 dark:text-gray-400",children:"no watches"})})]})}export{E as default};
